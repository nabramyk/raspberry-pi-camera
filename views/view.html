<!DOCTYPE html>
<head>
	<script>

		var url = 'http://localhost:8080/';

		function take_image() {
			var xmlHttp = new XMLHttpRequest();
			var params = document.getElementsByClassName("options");
			var sendToServer = "?mode=" + document.getElementById("camera_mode").value + "&";
			
			for(var i = 0; i < params.length; i++) {
				sendToServer = sendToServer + params[i].name + "=" + params[i].value + "&";
			}
			
			xmlHttp.open("POST", url+"take_image/"+sendToServer, true);

			xmlHttp.send(null);
		}

		window.onload = function() {
			var xmlHttp = new XMLHttpRequest();
			xmlHttp.onreadystatechange = function() {
				if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
					document.getElementById("selection_pane").innerHTML = xmlHttp.responseText;
				}
			};
			xmlHttp.open("GET", 'http://localhost:8080/views/monitor/');
			xmlHttp.send(null);
		}
		
		function update() {
			var xmlHttp = new XMLHttpRequest();
			xmlHttp.onreadystatechange = function() {
			if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
				i.innerHTML = xmlHttp.responseText;
				setTimeout(update, 1000);
				}
			}					
			xmlHttp.open("GET", 'http://localhost:8080/temp/');
			xmlHttp.send(null);
		}
		
		function show_hide_options(pane) {
			var x = document.getElementById(pane);
			if(x.style.display === 'none') {
				x.style.display = 'block';
			} else {
				x.style.display = 'none';
			}
		}
		
			//Arrays of object names which will be invisible depending on the camera mode
	var yuv_options = ["tags_button","raw_button","encoding_button","quality_button","vstab_button","bitrate_button","framerate_button","timeout_button"];
	var still_options = ["vstab_button","framerate_button","bitrate_button","timeout_button"];
	var video_options = ["tags_button","raw_button","timelapse_button","quality_button"];
	function switch_camera_modes(mode) {	
		var options = null;
		if(mode==="still") {
			options = still_options;
			document.getElementById("shutter_button").innerHTML = "Take Image";
		} else if(mode==="video") {
			options = video_options;
			document.getElementById("shutter_button").innerHTML = "Record Video";
		} else if(mode==="yuv") {
			options = yuv_options;
			document.getElementById("shutter_button").innerHTML = "Reocrd Image";
		}
		var temp = document.querySelectorAll(".additional_camera_options");
		for(var i=0; i<temp.length; i++) {
			temp[i].style.display = 'block';
		}
		for(var i=0; i<options.length; i++) {
			document.getElementById(options[i]).style.display = 'none';
		}
	}
	
				function scale_aspect_ratio(axis, amount) {
				if(document.getElementById("aspect_ratio_lock").checked) {
					var ratio = document.getElementById("aspect_ratio").value;
					var width = ratio.split(":")[0];
					var height = ratio.split(":")[1];
					if(axis=="width") {
						document.getElementById("aspect_width").value = Math.round(amount * width / height);
					} else {
						document.getElementById("aspect_height").value = Math.round(amount * height / width);
					}
				}
			}
			
		function toggle_uv_mode(checked) {
			if(checked) {
				document.getElementById("u_channel").disabled = false;
				document.getElementById("y_channel").disabled = false;
				document.getElementById("encoding").disabled = true;
			} else {
				document.getElementById("u_channel").disabled = true;
				document.getElementById("y_channel").disabled = true;
				document.getElementById("encoding").disabled = false;
			}
		}
		
		function toggle_timelapse_mode(checked) {
			if(checked) {
				document.getElementById("timelapse_interval").disabled = false;
				document.getElementById("timelapse_time_unit").disabled = false;
			} else {
				document.getElementById("timelapse_interval").disabled = true;
				document.getElementById("timelapse_time_unit").disabled = true;
			}
		}
	</script>
	<link rel="stylesheet" type="text/css" href="http://localhost:8080/views/style.css">
</head>
	<body>
		<div id="main_panel">
		<div class="main_panel">
			<header>
				<h1 id="header">RasPiCam</h1>
			</header>
			<div id="navigation_menu">
				<button id="monitor" type="button" class="navigation_button" value="selected" onClick="switch_modes(this.id)">MONITOR</button>
				<button id="camera" type="button" class="navigation_button" value="unselected" onClick="switch_modes(this.id)">CAMERA</button>
				<button id="system_info" type="button" class="navigation_button" value="unselected" onclick="switch_modes(this.id)">SYSTEM INFO</button>
			</div>
			<script>
				function switch_modes(mode) {
					var xmlHttp = new XMLHttpRequest();
					xmlHttp.onreadystatechange = function() {
						if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
						document.getElementById("selection_pane").innerHTML = xmlHttp.responseText;
					}
				};
				
				xmlHttp.open("GET", 'http://localhost:8080/views/' + mode + '/');
				xmlHttp.send(null);

				var params = document.getElementsByClassName("navigation_button");
				for(var i = 0; i < params.length; i++) {
					params[i].value="unselected";
				}
				document.getElementById(mode).value="selected";
			}
			</script>
			<div id="selection_pane"></div>
		</div>
		</div>
	</body>	
</html>
